{% extends "base.html" %}

{% block title %}FAQ –ú–µ–Ω—é{% endblock %}
{% block page_title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FAQ –º–µ–Ω—é{% endblock %}

{% block extra_css %}
<style>
    .menu-section {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 20px;
        background: white;
    }
    
    .menu-section-header {
        background-color: #f8f9fa;
        padding: 15px 20px;
        border-bottom: 1px solid #dee2e6;
        border-radius: 8px 8px 0 0;
        display: flex;
        justify-content: between;
        align-items: center;
    }
    
    .menu-section-title {
        font-weight: 600;
        margin: 0;
        color: #495057;
    }
    
    .menu-section-stats {
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .menu-items {
        padding: 0;
    }
    
    .menu-item {
        padding: 12px 20px;
        border-bottom: 1px solid #f1f3f4;
        display: flex;
        justify-content: between;
        align-items: center;
    }
    
    .menu-item:last-child {
        border-bottom: none;
    }
    
    .menu-item-title {
        flex-grow: 1;
        font-weight: 500;
        color: #495057;
    }
    
    .menu-item-actions {
        display: flex;
        gap: 5px;
    }
    
    .btn-sm-icon {
        width: 32px;
        height: 32px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .char-counter {
        font-weight: 500;
    }
    
    .char-counter.text-warning {
        color: #ffc107 !important;
    }
    
    .char-counter.text-danger {
        color: #dc3545 !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FAQ –º–µ–Ω—é</h3>
        <p class="text-muted mb-0">–°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è Telegram –±–æ—Ç–∞</p>
    </div>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSectionModal">
        <i class="bi bi-plus-circle"></i>
        –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª
    </button>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ total_sections }}</h4>
                        <p class="card-text">–í—Å–µ–≥–æ —Ä–∞–∑–¥–µ–ª–æ–≤</p>
                    </div>
                    <div class="align-self-center">
                        <i class="bi bi-list-ul" style="font-size: 2rem;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ total_questions }}</h4>
                        <p class="card-text">–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤</p>
                    </div>
                    <div class="align-self-center">
                        <i class="bi bi-chat-dots" style="font-size: 2rem;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –†–∞–∑–¥–µ–ª—ã –º–µ–Ω—é -->
<div class="menu-container">
    {% if sections %}
        {% for section in sections %}
        <div class="menu-section">
            <div class="menu-section-header">
                <div class="d-flex align-items-center flex-grow-1">
                    <h5 class="menu-section-title me-3">{{ section.title }}</h5>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <div class="menu-section-stats">
                        <i class="bi bi-chat-dots"></i>
                        {{ section.items|length }} –≤–æ–ø—Ä–æ—Å–æ–≤
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline-primary btn-sm"
                                data-bs-toggle="modal" data-bs-target="#addItemModal"
                                data-section-id="{{ section.id }}" 
                                data-section-title="{{ section.title }}"
                                data-action="add-question">
                            <i class="bi bi-plus"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm"
                                data-section-id="{{ section.id }}" 
                                data-section-title="{{ section.title }}"
                                data-section-order="{{ section.order_index }}"
                                data-action="edit-section">
                            <i class="bi bi-pencil"></i>
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-sm"
                                data-section-id="{{ section.id }}" 
                                data-section-title="{{ section.title }}"
                                data-section-items="{{ section.items|length }}"
                                data-action="delete-section">
                            <i class="bi bi-trash"></i>
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            {% if section.items %}
                <div class="menu-items">
                    {% for item in section.items %}
                    <div class="menu-item">
                        <div class="menu-item-title">
                            {{ item.title }}
                        </div>
                        <div class="menu-item-actions">
                            <button type="button" class="btn btn-outline-info btn-sm-icon view-item-btn"
                                    data-bs-toggle="modal" data-bs-target="#viewItemModal"
                                    data-item-title="{{ item.title }}" 
                                    data-item-content="{{ item.content }}">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm-icon edit-item-btn"
                                    data-item-id="{{ item.id }}" 
                                    data-item-title="{{ item.title }}" 
                                    data-item-content="{{ item.content }}" 
                                    data-item-order="{{ item.order_index }}"
                                    data-action="edit-item">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-sm-icon delete-item-btn"
                                    data-item-id="{{ item.id }}" 
                                    data-item-title="{{ item.title }}"
                                    data-action="delete-item">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="menu-items">
                    <div class="menu-item text-center text-muted">
                        <i class="bi bi-chat-dots me-2"></i>
                        –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤
                    </div>
                </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div class="text-center py-5">
            <i class="bi bi-list-ul text-muted" style="font-size: 3rem;"></i>
            <h4 class="text-muted mt-3">–†–∞–∑–¥–µ–ª—ã –º–µ–Ω—é –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
            <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª –¥–ª—è FAQ</p>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSectionModal">
                <i class="bi bi-plus-circle"></i>
                –°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–¥–µ–ª
            </button>
        </div>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ -->
<div class="modal fade" id="addSectionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="/faq/sections">
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –º–µ–Ω—é</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="addSectionTitle" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ *</label>
                        <input type="text" class="form-control" id="addSectionTitle" name="title" 
                               maxlength="64" required onkeyup="updateCharacterCount('addSectionTitle', 'addSectionCounter', 64)">
                        <div class="form-text">
                            <span id="addSectionCounter" class="char-counter">0/64 —Å–∏–º–≤–æ–ª–æ–≤</span>
                            <span class="text-muted ms-2">–ú–∞–∫—Å–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram)</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="addSectionOrder" class="form-label">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="number" class="form-control" id="addSectionOrder" name="order_index" 
                               value="{{ (total_sections + 1) * 10 }}" min="0">
                        <div class="form-text">–ß–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–¥–µ–ª</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞ -->
<div class="modal fade" id="editSectionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" id="editSectionForm">
                <div class="modal-header">
                    <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–¥–µ–ª –º–µ–Ω—é</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editSectionTitle" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ *</label>
                        <input type="text" class="form-control" id="editSectionTitle" name="title" 
                               maxlength="64" required onkeyup="updateCharacterCount('editSectionTitle', 'editSectionCounter', 64)">
                        <div class="form-text">
                            <span id="editSectionCounter" class="char-counter">0/64 —Å–∏–º–≤–æ–ª–æ–≤</span>
                            <span class="text-muted ms-2">–ú–∞–∫—Å–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram)</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editSectionOrder" class="form-label">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="number" class="form-control" id="editSectionOrder" name="order_index" min="0">
                        <div class="form-text">–ß–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ -->
<div class="modal fade" id="addItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="/faq/items">
                <div class="modal-header">
                    <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å –≤ —Ä–∞–∑–¥–µ–ª: <span id="currentSectionName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="add_item_section_id" name="section_id">
                    <div class="mb-3">
                        <label for="addItemTitle" class="form-label">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ (–≤–æ–ø—Ä–æ—Å) *</label>
                        <input type="text" class="form-control" id="addItemTitle" name="title" 
                               maxlength="64" required onkeyup="updateCharacterCount('addItemTitle', 'addItemCounter', 64)">
                        <div class="form-text">
                            <span id="addItemCounter" class="char-counter">0/64 —Å–∏–º–≤–æ–ª–æ–≤</span>
                            <span class="text-muted ms-2">–ú–∞–∫—Å–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram)</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="addItemContent" class="form-label">–û—Ç–≤–µ—Ç *</label>
                        <textarea class="form-control" id="addItemContent" name="content" rows="6" 
                                  required onkeyup="updateCharacterCount('addItemContent', 'addItemContentCounter', 4096)">‚ùì 


üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
1. </textarea>
                        <div class="form-text">
                            <span id="addItemContentCounter" class="char-counter">0/4096 —Å–∏–º–≤–æ–ª–æ–≤</span>
                            <span class="text-muted ms-2">–ú–∞–∫—Å–∏–º—É–º 4096 —Å–∏–º–≤–æ–ª–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram)</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="addItemOrder" class="form-label">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="number" class="form-control" id="addItemOrder" name="order_index" 
                               value="10" min="0">
                        <div class="form-text">–ß–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ -->
<div class="modal fade" id="editItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" id="editItemForm">
                <div class="modal-header">
                    <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit_item_section_id" name="section_id">
                    <div class="mb-3">
                        <label for="editItemTitle" class="form-label">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ (–≤–æ–ø—Ä–æ—Å) *</label>
                        <input type="text" class="form-control" id="editItemTitle" name="title" 
                               maxlength="64" required onkeyup="updateCharacterCount('editItemTitle', 'editItemCounter', 64)">
                        <div class="form-text">
                            <span id="editItemCounter" class="char-counter">0/64 —Å–∏–º–≤–æ–ª–æ–≤</span>
                            <span class="text-muted ms-2">–ú–∞–∫—Å–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram)</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editItemContent" class="form-label">–û—Ç–≤–µ—Ç *</label>
                        <textarea class="form-control" id="editItemContent" name="content" rows="6" 
                                  required onkeyup="updateCharacterCount('editItemContent', 'editItemContentCounter', 4096)"></textarea>
                        <div class="form-text">
                            <span id="editItemContentCounter" class="char-counter">0/4096 —Å–∏–º–≤–æ–ª–æ–≤</span>
                            <span class="text-muted ms-2">–ú–∞–∫—Å–∏–º—É–º 4096 —Å–∏–º–≤–æ–ª–æ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram)</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editItemOrder" class="form-label">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                        <input type="number" class="form-control" id="editItemOrder" name="order_index" min="0">
                        <div class="form-text">–ß–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–æ–ø—Ä–æ—Å–∞ -->
<div class="modal fade" id="viewItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ü—Ä–æ—Å–º–æ—Ç—Ä –≤–æ–ø—Ä–æ—Å–∞</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6>–í–æ–ø—Ä–æ—Å:</h6>
                    <div class="p-3 bg-light rounded" id="viewItemTitle"></div>
                </div>
                <div class="mb-3">
                    <h6>–û—Ç–≤–µ—Ç:</h6>
                    <div class="p-3 bg-light rounded" id="viewItemContent" style="white-space: pre-wrap;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="deleteConfirmText"></p>
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form method="post" id="deleteForm" style="display: inline;">
                    <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
    function updateCharacterCount(inputId, counterId, maxLength) {
        const input = document.getElementById(inputId);
        const counter = document.getElementById(counterId);
        const currentLength = input.value.length;
        
        counter.textContent = `${currentLength}/${maxLength} —Å–∏–º–≤–æ–ª–æ–≤`;
        
        // –ò–∑–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏–Ω—ã
        counter.className = 'char-counter';
        if (currentLength > maxLength * 0.9) {
            counter.classList.add('text-danger');
        } else if (currentLength > maxLength * 0.7) {
            counter.classList.add('text-warning');
        }
    }

    // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞
    function editSection(section) {
        document.getElementById('editSectionTitle').value = section.title;
        document.getElementById('editSectionOrder').value = section.order_index;
        document.getElementById('editSectionForm').action = `/faq/sections/${section.id}`;
        
        updateCharacterCount('editSectionTitle', 'editSectionCounter', 64);
        
        new bootstrap.Modal(document.getElementById('editSectionModal')).show();
    }

    // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
    function editItem(item) {
        document.getElementById('editItemTitle').value = item.title;
        document.getElementById('editItemContent').value = item.content;
        document.getElementById('editItemOrder').value = item.order_index;
        document.getElementById('editItemForm').action = `/faq/items/${item.id}`;
        
        updateCharacterCount('editItemTitle', 'editItemCounter', 64);
        updateCharacterCount('editItemContent', 'editItemContentCounter', 4096);
        
        new bootstrap.Modal(document.getElementById('editItemModal')).show();
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
    function viewItem(title, content) {
        document.getElementById('viewItemTitle').textContent = title;
        document.getElementById('viewItemContent').textContent = content;
        
        new bootstrap.Modal(document.getElementById('viewItemModal')).show();
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞
    function confirmDeleteSection(sectionId, sectionTitle, itemCount) {
        let message = `–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª "${sectionTitle}"?`;
        if (itemCount > 0) {
            message += ` –í–º–µ—Å—Ç–µ —Å –Ω–∏–º –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ ${itemCount} –≤–æ–ø—Ä–æ—Å–æ–≤.`;
        }
        
        document.getElementById('deleteConfirmText').textContent = message;
        document.getElementById('deleteForm').action = `/faq/sections/${sectionId}/delete`;
        
        new bootstrap.Modal(document.getElementById('confirmDeleteModal')).show();
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
    function confirmDeleteItem(itemId, itemTitle) {
        const message = `–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å "${itemTitle}"?`;
        
        document.getElementById('deleteConfirmText').textContent = message;
        document.getElementById('deleteForm').action = `/faq/items/${itemId}/delete`;
        
        new bootstrap.Modal(document.getElementById('confirmDeleteModal')).show();
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.addEventListener('DOMContentLoaded', function() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞
        document.querySelectorAll('[data-action="add-question"]').forEach(button => {
            button.addEventListener('click', function() {
                const sectionId = this.dataset.sectionId;
                const sectionTitle = this.dataset.sectionTitle;
                
                document.getElementById('add_item_section_id').value = sectionId;
                document.getElementById('currentSectionName').textContent = sectionTitle;
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —à–∞–±–ª–æ–Ω
                document.getElementById('addItemTitle').value = '';
                document.getElementById('addItemContent').value = `‚ùì 


üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
1. `;
                document.getElementById('addItemOrder').value = '10';
                
                updateCharacterCount('addItemTitle', 'addItemCounter', 64);
                updateCharacterCount('addItemContent', 'addItemContentCounter', 4096);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–∫—Ü–∏–∏
        document.querySelectorAll('[data-action="edit-section"]').forEach(button => {
            button.addEventListener('click', function() {
                const section = {
                    id: this.dataset.sectionId,
                    title: this.dataset.sectionTitle,
                    order_index: parseInt(this.dataset.sectionOrder)
                };
                editSection(section);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏
        document.querySelectorAll('[data-action="delete-section"]').forEach(button => {
            button.addEventListener('click', function() {
                const sectionId = this.dataset.sectionId;
                const sectionTitle = this.dataset.sectionTitle;
                const itemCount = parseInt(this.dataset.sectionItems);
                confirmDeleteSection(sectionId, sectionTitle, itemCount);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.querySelectorAll('[data-action="edit-item"]').forEach(button => {
            button.addEventListener('click', function() {
                const item = {
                    id: this.dataset.itemId,
                    title: this.dataset.itemTitle,
                    content: this.dataset.itemContent,
                    order_index: parseInt(this.dataset.itemOrder)
                };
                editItem(item);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.querySelectorAll('[data-action="delete-item"]').forEach(button => {
            button.addEventListener('click', function() {
                const itemId = this.dataset.itemId;
                const itemTitle = this.dataset.itemTitle;
                confirmDeleteItem(itemId, itemTitle);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.querySelectorAll('.view-item-btn').forEach(button => {
            button.addEventListener('click', function() {
                const title = this.dataset.itemTitle;
                const content = this.dataset.itemContent;
                viewItem(title, content);
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å–∏–º–≤–æ–ª–æ–≤
        updateCharacterCount('addSectionTitle', 'addSectionCounter', 64);
        updateCharacterCount('addItemTitle', 'addItemCounter', 64);
        updateCharacterCount('addItemContent', 'addItemContentCounter', 4096);
    });
</script>
{% endblock %} 